CREATE TABLE agency (id BIGINT AUTO_INCREMENT, name VARCHAR(64) NOT NULL, address VARCHAR(255) NOT NULL, address_bis VARCHAR(255), phone VARCHAR(15), mail VARCHAR(100), fax VARCHAR(15), slug VARCHAR(255), UNIQUE INDEX agency_sluggable_idx (slug), PRIMARY KEY(id)) ENGINE = MySIAM;
CREATE TABLE agency_room (id BIGINT AUTO_INCREMENT, name VARCHAR(64) NOT NULL, agency_id BIGINT, capacity BIGINT, slug VARCHAR(255), UNIQUE INDEX agency_room_sluggable_idx (slug), PRIMARY KEY(id)) ENGINE = MySIAM;
CREATE TABLE category (id BIGINT AUTO_INCREMENT, name VARCHAR(64) NOT NULL, short_description VARCHAR(255), description LONGTEXT, image VARCHAR(255), category_id BIGINT, is_active TINYINT(1), slug VARCHAR(255), UNIQUE INDEX category_sluggable_idx (slug), INDEX category_id_idx (category_id), PRIMARY KEY(id)) ENGINE = MySIAM;
CREATE TABLE formation_center (id BIGINT AUTO_INCREMENT, name VARCHAR(64) NOT NULL, image VARCHAR(255), address VARCHAR(255), address_bis VARCHAR(255), capacity BIGINT, slug VARCHAR(255), UNIQUE INDEX formation_center_sluggable_idx (slug), PRIMARY KEY(id)) ENGINE = MySIAM;
CREATE TABLE formation_session (id BIGINT AUTO_INCREMENT, name VARCHAR(64), formation_type_id BIGINT, capacity BIGINT, date_start DATETIME, date_end DATETIME, INDEX formation_type_id_idx (formation_type_id), PRIMARY KEY(id)) ENGINE = MySIAM;
CREATE TABLE formation_type (id BIGINT AUTO_INCREMENT, name VARCHAR(64) NOT NULL, PRIMARY KEY(id)) ENGINE = MySIAM;
CREATE TABLE package (id BIGINT AUTO_INCREMENT, name VARCHAR(64) NOT NULL, short_description VARCHAR(255), description LONGTEXT, price FLOAT(7, 2) NOT NULL, is_active TINYINT(1) DEFAULT '0', image VARCHAR(255), category_id BIGINT NOT NULL, slug VARCHAR(255), UNIQUE INDEX package_sluggable_idx (slug), INDEX category_id_idx (category_id), PRIMARY KEY(id)) ENGINE = MySIAM;
CREATE TABLE package_line (id BIGINT AUTO_INCREMENT, name VARCHAR(64) NOT NULL, image VARCHAR(255), package_id BIGINT, INDEX package_id_idx (package_id), PRIMARY KEY(id)) ENGINE = MySIAM;
CREATE TABLE single_offer (id BIGINT AUTO_INCREMENT, name VARCHAR(64) NOT NULL, short_description VARCHAR(255), description LONGTEXT, price FLOAT(7, 2), category_id BIGINT NOT NULL, is_active TINYINT(1), slug VARCHAR(255), UNIQUE INDEX single_offer_sluggable_idx (slug), INDEX category_id_idx (category_id), PRIMARY KEY(id)) ENGINE = MySIAM;
CREATE TABLE vehicle (id BIGINT AUTO_INCREMENT, name VARCHAR(64) NOT NULL, brand VARCHAR(64), model VARCHAR(64), year DATETIME NOT NULL, purchase_date DATETIME NOT NULL, next_verif_start DATETIME, next_verif_end DATETIME, agency_id BIGINT NOT NULL, vehicle_type_id BIGINT NOT NULL, slug VARCHAR(255), UNIQUE INDEX vehicle_sluggable_idx (slug), INDEX agency_id_idx (agency_id), INDEX vehicle_type_id_idx (vehicle_type_id), PRIMARY KEY(id)) ENGINE = MySIAM;
CREATE TABLE vehicle_type (id BIGINT AUTO_INCREMENT, name VARCHAR(64) NOT NULL, PRIMARY KEY(id)) ENGINE = MySIAM;
CREATE TABLE vehicle_verification (id BIGINT AUTO_INCREMENT, vehicle_id BIGINT, date_start DATETIME, date_end DATETIME, INDEX vehicle_id_idx (vehicle_id), PRIMARY KEY(id)) ENGINE = MySIAM;
CREATE TABLE sf_guard_group (id INT AUTO_INCREMENT, name VARCHAR(255) UNIQUE, description TEXT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_group_permission (group_id INT, permission_id INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(group_id, permission_id)) ENGINE = INNODB;
CREATE TABLE sf_guard_permission (id INT AUTO_INCREMENT, name VARCHAR(255) UNIQUE, description TEXT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_remember_key (id INT AUTO_INCREMENT, user_id INT, remember_key VARCHAR(32), ip_address VARCHAR(50), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX user_id_idx (user_id), PRIMARY KEY(id, ip_address)) ENGINE = INNODB;
CREATE TABLE sf_guard_user (id INT AUTO_INCREMENT, username VARCHAR(128) NOT NULL UNIQUE, algorithm VARCHAR(128) DEFAULT 'sha1' NOT NULL, salt VARCHAR(128), password VARCHAR(128), is_active TINYINT(1) DEFAULT '1', is_super_admin TINYINT(1) DEFAULT '0', last_login DATETIME, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX is_active_idx_idx (is_active), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_user_group (user_id INT, group_id INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(user_id, group_id)) ENGINE = INNODB;
CREATE TABLE sf_guard_user_permission (user_id INT, permission_id INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(user_id, permission_id)) ENGINE = INNODB;
CREATE TABLE sf_guard_user_profile (id BIGINT AUTO_INCREMENT, sf_guard_user_id BIGINT NOT NULL, agency_id BIGINT, first_name VARCHAR(64), last_name VARCHAR(64), birthday DATETIME, type BIGINT, mail VARCHAR(64), phone VARCHAR(15), mobile VARCHAR(15), slug VARCHAR(255), UNIQUE INDEX sf_guard_user_profile_sluggable_idx (slug), INDEX sf_guard_user_id_idx (sf_guard_user_id), INDEX agency_id_idx (agency_id), PRIMARY KEY(id)) ENGINE = MySIAM;
ALTER TABLE category ADD CONSTRAINT category_category_id_category_id FOREIGN KEY (category_id) REFERENCES category(id);
ALTER TABLE formation_session ADD CONSTRAINT formation_session_formation_type_id_formation_type_id FOREIGN KEY (formation_type_id) REFERENCES formation_type(id) ON DELETE SET NULL;
ALTER TABLE package ADD CONSTRAINT package_category_id_category_id FOREIGN KEY (category_id) REFERENCES category(id) ON DELETE SET NULL;
ALTER TABLE package_line ADD CONSTRAINT package_line_package_id_package_id FOREIGN KEY (package_id) REFERENCES package(id) ON DELETE SET NULL;
ALTER TABLE single_offer ADD CONSTRAINT single_offer_category_id_category_id FOREIGN KEY (category_id) REFERENCES category(id) ON DELETE SET NULL;
ALTER TABLE vehicle ADD CONSTRAINT vehicle_vehicle_type_id_vehicle_type_id FOREIGN KEY (vehicle_type_id) REFERENCES vehicle_type(id);
ALTER TABLE vehicle ADD CONSTRAINT vehicle_agency_id_agency_id FOREIGN KEY (agency_id) REFERENCES agency(id);
ALTER TABLE vehicle_verification ADD CONSTRAINT vehicle_verification_vehicle_id_vehicle_id FOREIGN KEY (vehicle_id) REFERENCES vehicle(id);
ALTER TABLE sf_guard_group_permission ADD CONSTRAINT sf_guard_group_permission_permission_id_sf_guard_permission_id FOREIGN KEY (permission_id) REFERENCES sf_guard_permission(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_group_permission ADD CONSTRAINT sf_guard_group_permission_group_id_sf_guard_group_id FOREIGN KEY (group_id) REFERENCES sf_guard_group(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_remember_key ADD CONSTRAINT sf_guard_remember_key_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_group ADD CONSTRAINT sf_guard_user_group_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_group ADD CONSTRAINT sf_guard_user_group_group_id_sf_guard_group_id FOREIGN KEY (group_id) REFERENCES sf_guard_group(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_permission ADD CONSTRAINT sf_guard_user_permission_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_permission ADD CONSTRAINT sf_guard_user_permission_permission_id_sf_guard_permission_id FOREIGN KEY (permission_id) REFERENCES sf_guard_permission(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_profile ADD CONSTRAINT sf_guard_user_profile_sf_guard_user_id_sf_guard_user_id FOREIGN KEY (sf_guard_user_id) REFERENCES sf_guard_user(id);
ALTER TABLE sf_guard_user_profile ADD CONSTRAINT sf_guard_user_profile_agency_id_agency_id FOREIGN KEY (agency_id) REFERENCES agency(id);
